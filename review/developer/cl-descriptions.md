# 编写良好的CL描述



CL描述是一种公开的记录，记录了做了**什么**改动以及**为什么**做这个改动。它会成为版本控制历史持久化的一部分，并且可能年复一年地会审查者之外的无数其他人阅读。

功能开发者会根据描述搜索到你的CL。未来有些人会由于想不起来而重要的具体情况而查找你的变更。如果所有的重要信息都在代码之中而非描述之中，他们要想定位到你的CL就会男的多。

## 首行 {#firstline}

*   简短概述做了什么。
*   句子要完整，就好像是写一条命令。
*   后面跟一行空行。

CL描述的**首行**应该是对CL*具体*完成了**什么** 进行简短概述，后面跟一空行。
这行会显示在版本控制历史概要中，所以应该给出足够的信息，以便未来搜索代码的人理解你的CL真正*做*了什么或者他和其他的CL有什么区别。也就是说，首行应该是独立的，允许读者通过代码历史更快地进行检索。

尽量保持首行简短、聚焦、直接。
清晰、有用对读者来说应该是首要考虑。

根据传统，CL描述首行应该是完整的一句话，就像是在写一条命令（祈使句）。比如说：\"**删除**FizzBuzz RPC并用新系统进行**替换**。"，而不说\"FizzBuzz RPC**删除**和新系统**替换**"。
不过，描述的其他内容不必写成祈使句。

## 内容体要提供有用的信息 {#informative}

The rest of the description should be informative. It might include a brief
description of the problem that's being solved, and why this is the best
approach. If there are any shortcomings to the approach, they should be
mentioned. If relevant, include background information such as bug numbers,
benchmark results, and links to design documents.

If you include links to external resources consider that they may not be visible
to future readers due to access restrictions or retention policies. Where
possible include enough context for reviewers and future readers to understand
the CL.

Even small CLs deserve a little attention to detail. Put the CL in context.

## 不好的CL描述 {#bad}

"Fix bug" is an inadequate CL description. What bug? What did you do to fix it?
Other similarly bad descriptions include:

-   "Fix build."
-   "Add patch."
-   "Moving code from A to B."
-   "Phase 1."
-   "Add convenience functions."
-   "kill weird URLs."

Some of those are real CL descriptions. Although short, they do not provide
enough useful information.

## 好的CL描述 {#good}

Here are some examples of good descriptions.

### 功能变更

Example:

> rpc: remove size limit on RPC server message freelist.
>
> Servers like FizzBuzz have very large messages and would benefit from reuse.
> Make the freelist larger, and add a goroutine that frees the freelist entries
> slowly over time, so that idle servers eventually release all freelist
> entries.

The first few words describe what the CL actually does. The rest of the
description talks about the problem being solved, why this is a good solution,
and a bit more information about the specific implementation.

### 重构

Example:

> Construct a Task with a TimeKeeper to use its TimeStr and Now methods.
>
> Add a Now method to Task, so the borglet() getter method can be removed (which
> was only used by OOMCandidate to call borglet's Now method). This replaces the
> methods on Borglet that delegate to a TimeKeeper.
>
> Allowing Tasks to supply Now is a step toward eliminating the dependency on
> Borglet. Eventually, collaborators that depend on getting Now from the Task
> should be changed to use a TimeKeeper directly, but this has been an
> accommodation to refactoring in small steps.
>
> Continuing the long-range goal of refactoring the Borglet Hierarchy.

The first line describes what the CL does and how this is a change from the
past. The rest of the description talks about the specific implementation, the
context of the CL, that the solution isn't ideal, and possible future direction.
It also explains *why* this change is being made.

### 需要一些上下文的小CL

Example:

> Create a Python3 build rule for status.py.
>
> This allows consumers who are already using this as in Python3 to depend on a
> rule that is next to the original status build rule instead of somewhere in
> their own tree. It encourages new consumers to use Python3 if they can,
> instead of Python2, and significantly simplifies some automated build file
> refactoring tools being worked on currently.

The first sentence describes what's actually being done. The rest of the
description explains *why* the change is being made and gives the reviewer a lot
of context.

## 生成的CL描述

Some CLs are generated by tools. Whenever possible, their descriptions should
also follow the advice here. That is, their first line should be short, focused,
and stand alone, and the CL description body should include informative details
that help reviewers and future code searchers understand each CL's effect.

## 在提交CL前审查其描述

CLs can undergo significant change during review. It can be worthwhile to review
a CL description before submitting the CL, to ensure that the description still
reflects what the CL does.

Next: [Small CLs](small-cls.md)
