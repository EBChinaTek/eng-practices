# 代码审查的标准



代码审查的主要目的是确保谷歌代码库的整体代码健康的到持续提升。所有代码审查的工具与过程都以此为目的而设计。

为了实现这个愿景，必须要平衡一系列的权衡点。

首先，开发人员必须能够在其任务中 _有所进展_ 。如果你从来没有响代码库中提交过一次改进，那代码库就永远不会改进。同时，如果审查者让 _任何_ 变更都非常难以进入代码库，就会抑制开发人员在未来做出改进。

另一方面，确保每个CL的质量不会随着时间降低代码库的整体质量是审查者的职责所在。
这很难察觉，因为通常，随着时间推移，代码健康会经历一系列微小的难以察觉的降低进而导致代码库降级。
特别是当团队在重要时间约束下，团队感觉到他们必须抄近路才能完成目标，这种情况就会发生。

同时，审查者对他们所审查的代码有所有权和责任。他们要确保代码库保持可持续、可维护，以及["代码审查看什么"](looking-for.md)中提到的所有事情。

因此，我们采用如下规则做为我们期望代码评审的标准：

**通常，当某个CL能明显提升目标系统整体代码健康的时候，审查者应该倾向于通过它，即便该CL并不完美。**

这是所有代码审查指南的 _唯一_ 高级原则。

当然，对此是有限制的。例如，如果一个CL添加了一个审查者不想要加入到系统的功能，那审查者当然能拒绝审核，即便代码设计很好。

此处的要点在于，不存在所谓的“完美的”代码&mdash;只有 _更好_ 的代码。审查者不应该要求作者打磨CL的每个小片段才授予通过。
相反，审查者应该在进度与所建议改进的重要性之间进行平衡。不要追求完美，审查者应该寻求 _持续的改进_ 。一个改进系统可维护性、可读性和可理解性的CL做为一个整体，不应当因不“完美”延迟数天或数周。

审查者应该 _总是_ 可以自由发表评论表示有些事情可以更好，但如果不是非常重要，需要加以写诸如“Nit：”的前缀让作者直到这是可以选择忽略的打磨点。

注意：本文档没有为签入明显让系统的整体代码健康 _更差_ 的CL做辩护。只有在[紧急情况](../emergencies.md)下才能这样做。

## 辅导

代码审查有个很重要的功能，那就是教开发人员有关一门语言、一个框架或通用软件设计原则的新知识。
留下评论帮助开发人员学习一些新的知识总是好的。共享知识是长期改进系统代码健康的一部分。
需要时刻谨记，如果你的评论纯粹是教育性的，但对满足本文档所描述的标准无关紧要，请标注前缀“Nit：”或其明确说明不强制作者在这个CL中解决。

## 原则 {#principles}

*   技术事实和数据拒绝想法和个人偏好。

*   强调风格，[风格指南](http://google.github.io/styleguide/)是绝对权威。任何风格指南之外的纯粹风格点（空格等）按个人偏好决定。
    风格应该与已有代码一致。若之前无风格，就接受作者的风格。
    
*   **软件设计访问绝不是单纯的风格问题或只是某种个人偏好**。
    它们是基于底层原则的，并且应当斟酌这些原则，而不是简单的个人想法。有时会有一些合理选项。
    如果作者能够演示（即可以通过数据，也可以基于铁证如山的工程原则）若干同样有效的方法，那么审查者就应当接受作者的偏好。
    否则，就应该严格按照软件设计的标准原则进行。

*   如果没有应用其他规则，那审查者可以要求作者与当前代码库保持一致，只要不会让系统整体代码健康更糟糕就可以。

## 解决冲突 {#conflicts}

在一次代码审查中的任何冲突中，第一步永远应当是根据本文档和[CL作者指南](../developer/)中的其他文档以及本[审查者指南](index.md)的内容让开发人员和审查者尽量达成共识。

如果打成共识特别困难，审查者和作者进行一次面对面的会议或视频比仅仅通过代码审查评论来解决冲突更有帮助。（如果你这样做，确保将讨论结果记录在CL评论中，以便未来的读者了解）。

如果无法解决冲突情形，解决的最常见的方式是冲突升级。通常升级路径是开展更广泛的团队讨论、让技术领导定夺、向代码的维护者寻求决定、或者让工程经理帮忙。
**不要因为作者和审查者无法达成共识而停滞不前**。
out. **Don't let a CL sit around because the author and the reviewer can't come
to an agreement.**

接下来：[代码审查中看什么](looking-for.md)
